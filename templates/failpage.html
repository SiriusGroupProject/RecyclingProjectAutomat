<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fail</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="../static/bootstrap/jquery.min.js"></script>
    <script src="../static/bootstrap/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>
    <script src="../static/bootstrap/animation.js"></script>
    <script>
        counter = 0;

        function closeConnection() {
            var settings = {
                "async": true,
                "crossDomain": true,
                "url": "http://localhost:8080/connections/closeOrNewTransaction/{{ connected_user }}/{{ automat_id }}/{{ barcode }}/1/0",
                "method": "POST"
            }

            $.ajax(settings).done(function (response) {
                if (response.toString() === "true") {
                    window.location.href = '/';
                } else {
                    console.log(response.toString());
                    counter++;
                    if (counter < 5) {
                        setTimeout(closeConnection, 1000);
                    } else {
                        alert("Bağlantınız Bulunmamaktadir!");
                        window.location.href = '/';
                    }
                }
            }).fail(function () {
                if (counter < 5) {
                    counter++;
                    closeConnection()
                } else {
                    window.location.href = '/';
                }

            });
        }

        function newTransaction() {
            var settings = {
                "async": true,
                "crossDomain": true,
                "url": "http://localhost:8080/connections/closeOrNewTransaction/{{ connected_user }}/{{ automat_id }}/{{ barcode }}/1/1",
                "method": "POST"
            }

            $.ajax(settings).done(function (response) {
                if (response.toString() === "false") {
                    window.location.href = "/connected/{{ connected_user }}";
                } else {
                    console.log(response.toString());
                    counter++;
                    if (counter < 5) {
                        setTimeout(closeConnection, 1000);
                    } else {
                        alert("Bağlantınız Bulunmamaktadir!");
                        window.location.href = '/';
                    }
                }
            }).fail(function () {
                if (counter < 5) {
                    counter++;
                    closeConnection()
                } else {
                    window.location.href = '/';
                }

            });
        }

        function retryWithSameBarcode() {
            var settings = {
                "async": true,
                "crossDomain": true,
                "url": "http://localhost:8080/connections/closeOrNewTransaction/{{ connected_user }}/{{ automat_id }}/{{ barcode }}/1/3",
                "method": "POST"
            }

            $.ajax(settings).done(function (response) {
                if (response.toString() === "false") {
                    window.location.href = "/closeCoverOnFail/{{ barcode }}";
                } else {
                    console.log(response.toString());
                    counter++;
                    if (counter < 5) {
                        setTimeout(closeConnection, 1000);
                    } else {
                        alert("Bağlantınız Bulunmamaktadir!");
                        window.location.href = '/';
                    }
                }
            }).fail(function () {
                if (counter < 5) {
                    counter++;
                    closeConnection()
                } else {
                    window.location.href = '/';
                }

            });
        }
    </script>
    <style>
        .center {
            align-items: center;
        }

        .button1 {
            background-color: white;
            color: black;
            alignment: right;
            border: 2px solid #4CAF50;
        }

        .button1:hover {
            background-color: #4CAF50;
            color: white;
        }

        .button2 {
            background-color: white;
            color: black;
            alignment: left;
            border: 2px solid #f44336;

        }

        .button2:hover {
            background-color: #f44336;
            color: white;
        }
    </style>
</head>
<body>


<h1 style="color: white;background-color: green;text-align: center">Üzgünüm</h1>
<h4 style="text-align: center">Barkodunu okuttuğunuz şişe ve görüntü eşleşmemektedir.<br> Şişenizi hazneden alabilirsiniz. </h4>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br>
<br>
<br>
<div style="display: inline-block;">
    <p> Aynı şişe için tekrar denemek için tıklayınız...</p>
    <button class="button1" onclick="retryWithSameBarcode()">Tekrar Dene</button>
</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

<div style="display: inline-block;">
    <p> Yeni bir şişe okutmak için tıklayınız...</p>
    <button class="button1" onclick="newTransaction()">Yeni İşlem</button>
</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

<div class="center" style="display: inline-block;">
    <p> Bağlantıyı sonlandırmak için tıklayınız...</p>
    <button class="button2" onclick="closeConnection()">Çıkış</button>
</div>
</body>
</html>